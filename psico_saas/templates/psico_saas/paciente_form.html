{% extends 'psico_saas/base.html' %}
{% load static %}

{% block title %}{% if is_editing %}Editar{% else %}Novo{% endif %} Paciente - Psico Assist{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div class="plano-header-content">
            <div class="title-section">
                <h2 class="card-title">
                    {% if is_editing %}
                    ‚úèÔ∏è Editar Paciente
                    {% else %}
                    üë• Novo Paciente
                    {% endif %}
                </h2>
                <p class="plan-manager">
                    {% if is_editing %}
                    Atualize os dados do paciente
                    {% else %}
                    Cadastre um novo paciente no sistema
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    <div class="card-body">
        {% if error_message %}
        <div class="alert alert-error">
            <i class="bi bi-exclamation-triangle"></i>
            {{ error_message }}
        </div>
        {% endif %}

        {% if success_message %}
        <div class="alert alert-success">
            <i class="bi bi-check-circle"></i>
            {{ success_message }}
        </div>
        {% endif %}

        <form method="post" class="paciente-form">
            {% csrf_token %}

            <!-- Dados Pessoais -->
            <div class="form-section">
                <h3 class="section-title">üìã Dados Pessoais</h3>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="nome_completo" class="form-label required">Nome Completo</label>
                        <input type="text" id="nome_completo" name="nome_completo" class="form-control"
                            value="{{ paciente.nome_completo|default:'' }}"
                            placeholder="Digite o nome completo do paciente" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="data_nascimento" class="form-label">Data de Nascimento</label>
                        <input type="date" id="data_nascimento" name="data_nascimento" class="form-control"
                            value="{{ paciente.data_nascimento|date:'Y-m-d'|default:'' }}">
                    </div>

                    <div class="form-group">
                        <label for="sexo" class="form-label">Sexo</label>
                        <select id="sexo" name="sexo" class="form-control form-select">
                            <option value="">Selecione...</option>
                            {% for valor, label in sexo_choices %}
                            <option value="{{ valor }}" {% if paciente.sexo == valor %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <!-- Contato -->
            <div class="form-section">
                <h3 class="section-title">üìû Contato</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="email" class="form-label">E-mail</label>
                        <input type="email" id="email" name="email" class="form-control"
                            value="{{ paciente.email|default:'' }}" placeholder="email@exemplo.com">
                    </div>

                    <div class="form-group">
                        <label for="telefone" class="form-label">Telefone</label>
                        <input type="tel" id="telefone" name="telefone" class="form-control"
                            value="{{ paciente.telefone|default:'' }}" placeholder="(11) 99999-9999">
                    </div>
                </div>

                <div class="form-group">
                    <label for="contato_emergencia" class="form-label">Contato de Emerg√™ncia</label>
                    <input type="text" id="contato_emergencia" name="contato_emergencia" class="form-control"
                        value="{{ paciente.contato_emergencia|default:'' }}"
                        placeholder="Nome e telefone do contato de emerg√™ncia">
                </div>
            </div>

            <!-- Endere√ßo -->
            <div class="form-section">
                <h3 class="section-title">üè† Endere√ßo</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cep" class="form-label">CEP</label>
                        <input type="text" id="cep" name="cep" class="form-control"
                            value="{{ paciente.cep|default:'' }}" placeholder="00000-000" maxlength="9">
                    </div>

                    <div class="form-group">
                        <label for="logradouro" class="form-label">Rua/Avenida</label>
                        <input type="text" id="logradouro" name="logradouro" class="form-control"
                            value="{{ paciente.logradouro|default:'' }}" placeholder="Nome da rua ou avenida">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="numero" class="form-label">N√∫mero</label>
                        <input type="text" id="numero" name="numero" class="form-control"
                            value="{{ paciente.numero|default:'' }}" placeholder="123">
                    </div>

                    <div class="form-group">
                        <label for="complemento" class="form-label">Complemento</label>
                        <input type="text" id="complemento" name="complemento" class="form-control"
                            value="{{ paciente.complemento|default:'' }}" placeholder="Apto 101, Casa 2, etc.">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="bairro" class="form-label">Bairro</label>
                        <input type="text" id="bairro" name="bairro" class="form-control"
                            value="{{ paciente.bairro|default:'' }}" placeholder="Nome do bairro">
                    </div>

                    <div class="form-group">
                        <label for="cidade" class="form-label">Cidade</label>
                        <input type="text" id="cidade" name="cidade" class="form-control"
                            value="{{ paciente.cidade|default:'' }}" placeholder="Nome da cidade">
                    </div>

                    <div class="form-group">
                        <label for="estado" class="form-label">Estado</label>
                        <input type="text" id="estado" name="estado" class="form-control"
                            value="{{ paciente.estado|default:'' }}" placeholder="SP, RJ, MG, etc." maxlength="2">
                    </div>
                </div>
            </div>

            <!-- Observa√ß√µes -->
            <div class="form-section">
                <h3 class="section-title">üìù Observa√ß√µes</h3>
                <div class="form-group full-width">
                    <label for="observacoes" class="form-label">Observa√ß√µes e Anota√ß√µes</label>
                    <textarea id="observacoes" name="observacoes" class="form-control" rows="4"
                        placeholder="Anota√ß√µes importantes sobre o paciente...">{{ paciente.observacoes|default:'' }}</textarea>
                </div>
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-circle"></i>
                    {% if is_editing %}Atualizar Paciente{% else %}Cadastrar Paciente{% endif %}
                </button>
                <a href="{% url 'listar_pacientes' %}" class="btn btn-outline">
                    <i class="bi bi-arrow-left"></i>
                    Voltar para Lista
                </a>
            </div>
        </form>
    </div>
</div>

<style>
    .card {
        margin-top: 4em;
    }

    .paciente-form .form-section {
        margin-bottom: var(--space-xl);
        padding-bottom: var(--space-lg);
        border-bottom: 1px solid var(--border-light);
    }

    .paciente-form .form-section:last-of-type {
        border-bottom: none;
    }

    .section-title {
        color: var(--primary);
        margin-bottom: var(--space-md);
        font-size: 1.2rem;
        font-weight: 600;
    }

    .form-row {
        display: flex;
        gap: var(--space-md);
        flex-wrap: wrap;
        margin-bottom: var(--space-md);
    }

    .form-row:last-child {
        margin-bottom: 0;
    }

    .form-group {
        flex: 1;
        min-width: 200px;
    }

    .form-group.full-width {
        flex: 1 1 100%;
    }

    .form-label {
        display: block;
        margin-bottom: var(--space-xs);
        font-weight: 500;
        color: var(--text-primary);
    }

    .form-label.required::after {
        content: " *";
        color: var(--error);
    }

    .form-control {
        width: 100%;
    }

    .form-actions {
        display: flex;
        gap: var(--space-md);
        justify-content: flex-start;
        margin-top: var(--space-xl);
        padding-top: var(--space-lg);
        border-top: 1px solid var(--border-light);
    }

    @media (max-width: 768px) {
        .form-row {
            flex-direction: column;
            gap: var(--space-sm);
        }

        .form-group {
            min-width: 100%;
        }

        .form-actions {
            flex-direction: column;
        }
    }
</style>

{% endblock %}